# Supported Elasticsearch versions

* `6.1.1`

# What is elasticsearch?

Elasticsearch is a distributed, RESTful search and analytics engine capable of solving a growing number of use cases. As the heart of the Elastic Stack, it centrally stores your data so you can discover the expected and uncover the unexpected.
This image uses [search-guard](https://github.com/floragunncom/search-guard) instead of shield to handle trusted users.

[<img src="https://static-www.elastic.co/fr/assets/blt9a26f88bfbd20eb5/icon-elasticsearch-bb.svg?q=802" width="144" height="144">](https://www.elastic.co/fr/products/elasticsearch)

This solution focuses on running a dockerized version of elasticsearch in the Google Compute Engine.
It has the following preinstalled and preconfigured plugins:
* [SearchGuard](https://search-guard.com/)
* [Xpack](https://www.elastic.co/guide/en/x-pack/current/xpack-introduction.html)
* [Gce Discovery](https://www.elastic.co/guide/en/elasticsearch/plugins/6.2/discovery-gce.html)
* [Gce Repository](https://www.elastic.co/guide/en/elasticsearch/plugins/master/repository-gcs.html)

# How To Use
Configure `docker` to be able to push `gcr.io` with ` gcloud auth configure-docker`

Create a `gce.env` file. (there is a `gce.env.sample` as an example) Make sure you have an environment variable `PROJECT_ID` defined with your google project ID.

Make sure you have `gcloud` installed and configured. Look up the supported build options in the `Makefile`

The `default` target would build the docker image, push it to your `gcr.io` and create a cluster in your project.

The build process will create the `elastic.env` which will have all the user passwords and environment variables provided to the cluster.

# Environment Variables (make sure to include them into your gce.env file if you want to change the default values)

##### LOG_LEVEL | `INFO`

Log level from witch elasticsearch echoes logs.

## Cluster

##### CLUSTER_NAME | `elasticsearch`
ES cluster name.

##### MINIMUM_MASTER_NODES | `1`
[This setting]((https://www.elastic.co/guide/en/elasticsearch/guide/1.x/_important_configuration_changes.html#_minimum_master_nodes)) tells Elasticsearch to not elect a master unless there are enough master-eligible nodes available. Only then will an election take place.
We recommend to set this variable to `(number of nodes / 2) + 1`

## Security & Roles
All the passwords are autogenerated when the template is created
##### ELASTIC_PWD
password for built-in user *elastic*.

##### KIBANA_PWD
password for built-in user *kibana*.

##### LOGSTASH_PWD
password for built-in user *logstash*.

##### BEATS_PWD
password for built-in user *beats*.

##### CA_PWD
CA certificate passphrase.

##### TS_PWD
Truststore(public keys storage) password.

##### KS_PWD
Keystore(private key storage) password.

##### HTTP_SSL | `true`
* If **true** then **https** is bound on **9200**
* If **false** then **http** is bound on **9200**

# Configure Elasticsearch

Configuration file is located in `/config/elasticsearch.yml`

# User Feedback
## Issues
If you have any problems with or questions about this image, please ask for help through a [GitHub issue](https://github.com/ebates-inc/docker-elasticsearch/issues).
