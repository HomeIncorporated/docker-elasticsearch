This project focuses on running a fully preconfigured, dockerized version of ElasticSearch on various cloud providers. Current supported platforms are  [GCE](https://cloud.google.com/compute) , but [AWS](https://aws.amazon.com/) is in the works.

The custom configuration includes:
* [SearchGuard](https://search-guard.com/) (Security, SSL transport/http layer, User Role Management)
* [Xpack](https://www.elastic.co/guide/en/x-pack/current/xpack-introduction.html) (Monitoring)
* [GCE Discovery](https://www.elastic.co/guide/en/elasticsearch/plugins/6.2/discovery-gce.html)
* [GCS Repository](https://www.elastic.co/guide/en/elasticsearch/plugins/master/repository-gcs.html)


# Supported ElasticSearch versions

* `6.1.0 -> 6.2.4`

# How To Use
Configure `docker` to be able to push `gcr.io` with ` gcloud auth configure-docker`

Create a `gce.env` file. (there is a `gce.env.sample` as an example) Make sure you have an environment variable `PROJECT_ID` defined with your google project ID.

Make sure you have `gcloud` installed and configured. Look up the supported build options in the `Makefile`

The `default` target would build the docker image, push it to your `gcr.io` and create a cluster in your project.

The build process will create the `elastic.env` which will have all the user passwords and environment variables provided to the cluster.

# Environment Variables (make sure to include them into your gce.env file if you want to change the default values)

##### LOG_LEVEL | `INFO`

Log level from witch elasticsearch echoes logs.

## Cluster

##### CLUSTER_NAME | `elasticsearch`
ES cluster name.

##### MINIMUM_MASTER_NODES | `1`
[This setting]((https://www.elastic.co/guide/en/elasticsearch/guide/1.x/_important_configuration_changes.html#_minimum_master_nodes)) tells Elasticsearch to not elect a master unless there are enough master-eligible nodes available. Only then will an election take place.
We recommend to set this variable to `(number of nodes / 2) + 1`

## Security & Roles
All the passwords are autogenerated when the template is created
##### ELASTIC_PWD
password for built-in user *elastic*.

##### KIBANA_PWD
password for built-in user *kibana*.

##### LOGSTASH_PWD
password for built-in user *logstash*.

##### BEATS_PWD
password for built-in user *beats*.

##### CA_PWD
CA certificate passphrase.

##### TS_PWD
Truststore(public keys storage) password.

##### KS_PWD
Keystore(private key storage) password.

##### HTTP_SSL | `true`
* If **true** then **https** is bound on **9200**
* If **false** then **http** is bound on **9200**

# Configure Elasticsearch

Configuration file is located in `/config/elasticsearch.yml`

# User Feedback
## Issues
If you have any problems with or questions about this image, please ask for help through a [GitHub issue](https://github.com/ebates-inc/docker-elasticsearch/issues).
